<div id="epg-navigation">
  <button
    [matTooltip]="'CLOSE' | translate"
    mat-icon-button
    (click)="close()"
    >
    <mat-icon>close</mat-icon>
  </button>
  <button
    [matTooltip]="'EPG.PREVIOUS_DAY' | translate"
    mat-icon-button
    (click)="switchDay('prev')"
    >
    <mat-icon>chevron_left</mat-icon>
  </button>
  <div class="today-date">
    {{ today | momentDate: 'YYYYMMDD' : 'MMMM Do, dddd' }}
  </div>
  <button
    [matTooltip]="'EPG.NEXT_DAY' | translate"
    mat-icon-button
    (click)="switchDay('next')"
    >
    <mat-icon>chevron_right</mat-icon>
  </button>
  <button mat-icon-button (click)="zoomOut()" [disabled]="(hourWidth$ | async)! <= 50" matTooltip="Zoom out">
    <mat-icon>remove</mat-icon>
  </button>
  <button mat-icon-button (click)="zoomIn()" [disabled]="(hourWidth$ | async)! >= 800" matTooltip="Zoom in">
    <mat-icon>add</mat-icon>
  </button>
</div>
<div class="parent" #epgContainer (scroll)="onScroll($event)">
  <svg id="channels-column" [attr.height]="(channels$ | async)!.length * barHeight + barHeight + 50">
    @for (item of channels$ | async; track item.id; let i = $index) {
      <g>
        <!-- channel name -->
        <g class="channel" [class.active]="item.id === activeChannelId">
          <rect
            width="100"
            [attr.height]="barHeight"
            [attr.y]="barHeight * i + barHeight"
            stroke="black"
            />
          <foreignObject
            width="100"
            [attr.height]="barHeight"
            [attr.y]="barHeight * i + barHeight"
            >
            <div class="channel-name">
              @if (getChannelIcon(item)) {
                <img
                  [src]="getChannelIcon(item)"
                  [alt]="getChannelName(item)"
                  style="height: 20px; width: 20px; margin-right: 8px;"
                  >
              }
              <span>{{ getChannelName(item) }}</span>
            </div>
          </foreignObject>
        </g>
      </g>
    }
  </svg>
  <div id="epg-container" [style.height.px]="(channels$ | async)!.length * barHeight + barHeight + 50">
    <svg [attr.width]="(hourWidth$ | async)! * 24" [attr.height]="(channels$ | async)!.length * barHeight + barHeight + 50" id="epg-svg">
      <!-- time headline -->
      @for (hour of timeHeader; track hour) {
        <g>
          <rect
            [matTooltip]="hour + ':00'"
            [attr.width]="hourWidth$ | async"
            [attr.height]="barHeight"
            [attr.x]="hour * (hourWidth$ | async)!"
            fill="#000"
          ></rect>
          <text
            [attr.x]="hour * (hourWidth$ | async)!"
            y="10"
            font-size="14"
            fill="white"
            transform="translate(20,20)"
            >
            {{ hour }}:00
          </text>
          <!-- vertical hour separator line -->
          <line
            [attr.x1]="hour * (hourWidth$ | async)!"
            [attr.y1]="barHeight"
            [attr.x2]="hour * (hourWidth$ | async)!"
            [attr.y2]="(channels$ | async)!.length * barHeight + barHeight"
            class="hour-separator"
          ></line>
        </g>
      }

      <!-- epg channels with programs -->
      @for (item of channels$ | async; track item.id; let i = $index) {
        <g [class.active-row]="item.id === activeChannelId">
          @for (program of item.programs; track trackByProgram($index, program)) {
            <g
              [attr.transform]="'translate(' + program.startPosition + ',' + (barHeight * i + barHeight) + ')'"
              class="program"
              (click)="showDescription(program)"
              >
              <rect
                [attr.width]="program.width"
                [attr.height]="barHeight"
                [matTooltip]="program.title[0].value"
              ></rect>
              <foreignObject
                [attr.width]="program.width"
                [attr.height]="barHeight"
                >
                <div class="program-title">{{ program.title[0]?.value }}</div>
              </foreignObject>
            </g>
          }
        </g>
      }

      <!-- current time line -->
      <line
        [attr.x1]="currentTimeLine"
        y1="0"
        [attr.x2]="currentTimeLine"
        [attr.y2]="(channels$ | async)!.length * barHeight + barHeight"
        stroke="red"
        stroke-width="2"
      ></line>
    </svg>
  </div>
</div>
