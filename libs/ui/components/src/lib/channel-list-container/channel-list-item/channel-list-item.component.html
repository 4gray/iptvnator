<div
    class="channel-list-item"
    [class.compact]="!showEpg"
    cdkDrag
    [cdkDragDisabled]="!isDraggable"
    cdkDragPreviewContainer="parent"
    [class.active]="selected"
    (click)="clicked.emit()"
    data-test-id="channel-item"
>
    @if (isDraggable) {
        <mat-icon cdkDragHandle class="drag-icon">drag_indicator</mat-icon>
    }
    <div class="channel-content">
        @if (logo) {
            <img
                class="channel-logo"
                [src]="logo"
                onerror="this.style.display='none'"
                alt="Channel Logo"
            />
        }
        <div class="channel-details">
            <div class="channel-name">{{ name }}</div>
            @if (showEpg) {
                <div class="epg-container">
                    <div class="epg-content">
                        @if (epgProgram) {
                            <div class="epg-title">
                                {{ epgProgram.title }}
                            </div>
                            <div class="epg-timeline">
                                <span class="epg-time"
                                    >{{ formatTime(epgProgram.start) }} -
                                    {{ formatTime(epgProgram.stop) }}</span
                                >
                                <div class="epg-progress-track">
                                    <div
                                        class="epg-progress-fill"
                                        [ngStyle]="{
                                            width: progressPercentage + '%',
                                        }"
                                    ></div>
                                </div>
                            </div>
                        } @else {
                            <div class="epg-placeholder">
                                {{ 'EPG.NO_PROGRAM_INFO' | translate }}
                            </div>
                        }
                    </div>
                    @if (epgProgram) {
                        <button
                            mat-icon-button
                            class="program-info-button"
                            [matTooltip]="
                                'EPG.PROGRAM_DIALOG.SHOW_PROGRAM_DETAILS'
                                    | translate
                            "
                            (click)="showProgramDescription(epgProgram, $event)"
                        >
                            <mat-icon>info</mat-icon>
                        </button>
                    }
                </div>
            }
        </div>
    </div>
    @if (showFavoriteButton) {
        <button
            mat-icon-button
            class="favorite-button"
            color="primary"
            [matTooltip]="'CHANNELS.REMOVE_FAVORITE' | translate"
            (click)="favoriteToggled.emit($event)"
        >
            <mat-icon color="accent">star</mat-icon>
        </button>
    }
</div>
