@let isEmbeddedPlayer = player() === 'videojs' || player() === 'html5';

<div class="live-stream-container" [class.mobile-layout]="isMobileLayout()">
    <!-- Mobile Menu Toggle -->
    <button 
        class="mobile-menu-toggle" 
        (click)="toggleMobileMenu()"
        [attr.aria-label]="'PORTALS.MOBILE_MENU' | translate"
        [attr.aria-expanded]="isMobileMenuOpen()"
    >
        <mat-icon>{{ isMobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
    </button>

    <!-- Mobile Navigation Overlay -->
    <div 
        class="mobile-nav-overlay" 
        [class.visible]="isMobileMenuOpen()"
        (click)="closeMobileMenu()"
    ></div>

    <!-- Channels Sidebar -->
    <div class="sidebar" [class.open]="isMobileMenuOpen()">
        <div class="sidebar-header">
            @if (selectedCategoryId()) {
                <button mat-icon-button (click)="backToCategories()">
                    <mat-icon>chevron_left</mat-icon>
                </button>
                <h2>{{ 'HOME.PLAYLISTS.CHANNELS' | translate }}</h2>
            } @else {
                <h2>{{ 'PORTALS.ALL_CATEGORIES' | translate }}</h2>
            }
            
            <!-- Collapse/Expand Button for Desktop -->
            <button 
                class="collapse-toggle" 
                (click)="toggleSidebar()"
                [attr.aria-label]="'PORTALS.TOGGLE_SIDEBAR' | translate"
            >
                <mat-icon>{{ isSidebarCollapsed() ? 'chevron_right' : 'chevron_left' }}</mat-icon>
            </button>
        </div>
        
        <div class="sidebar-content" [class.collapsed]="isSidebarCollapsed()">
            @if (selectedCategoryId()) {
                <app-portal-channels-list (playClicked)="playLive($event)" />
            } @else {
                <app-category-view
                    [items]="categories()"
                    (categoryClicked)="selectCategory($event)"
                />
            }
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-container">
        @if (streamUrl) {
            <!-- Video Player Section -->
            <div class="video-section">
                <div class="video-header">
                    <h3>{{ 'PORTALS.NOW_PLAYING' | translate }}</h3>
                    <div class="video-controls">
                        <button 
                            mat-icon-button 
                            (click)="toggleVideoPopout()"
                            [attr.aria-label]="'PORTALS.POPOUT_VIDEO' | translate"
                            class="popout-btn"
                        >
                            <mat-icon>open_in_new</mat-icon>
                        </button>
                        <button 
                            mat-icon-button 
                            (click)="toggleFullscreen()"
                            [attr.aria-label]="'PORTALS.FULLSCREEN' | translate"
                        >
                            <mat-icon>fullscreen</mat-icon>
                        </button>
                    </div>
                </div>
                
                @if (isVideoPopout()) {
                    <div class="video-popout-container">
                        <div class="popout-header">
                            <span>{{ 'PORTALS.VIDEO_POPOUT' | translate }}</span>
                            <button 
                                mat-icon-button 
                                (click)="closeVideoPopout()"
                                [attr.aria-label]="'PORTALS.CLOSE_POPOUT' | translate"
                            >
                                <mat-icon>close</mat-icon>
                            </button>
                        </div>
                        <div class="video-player popout">
                            <app-web-player-view [streamUrl]="streamUrl" />
                        </div>
                    </div>
                } @else {
                    <div class="video-player">
                        <app-web-player-view [streamUrl]="streamUrl" />
                    </div>
                }
            </div>

            <!-- EPG Section -->
            <div class="epg-section">
                <div class="epg-header">
                    <h3>{{ 'PORTALS.EPG' | translate }}</h3>
                    <button 
                        mat-icon-button 
                        (click)="toggleEpg()"
                        [attr.aria-label]="'PORTALS.TOGGLE_EPG' | translate"
                    >
                        <mat-icon>{{ isEpgVisible() ? 'visibility_off' : 'visibility' }}</mat-icon>
                    </button>
                </div>
                
                @if (isEpgVisible() && epgItems().length > 0) {
                    <div class="epg-content">
                        <app-epg-view [epgItems]="epgItems()" />
                    </div>
                }
            </div>
        } @else {
            <div class="no-channel-selected">
                <mat-icon>play_circle_outline</mat-icon>
                <h3>{{ 'PORTALS.SELECT_CATEGORY' | translate }}</h3>
                <p>{{ 'PORTALS.SELECT_CATEGORY_DESC' | translate }}</p>
            </div>
        }
    </div>
</div>
