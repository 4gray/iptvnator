<section class="seasons-section">
    <div class="section-header">
        <h3 class="section-title">Seasons and Episodes</h3>
        @if (selectedSeason) {
            <button class="back-btn" (click)="selectedSeason = undefined">
                <mat-icon>arrow_back</mat-icon>
                <span>Back to seasons</span>
            </button>
        }
    </div>

    <div class="content-container">
        @if (isLoading()) {
            <div class="loading-container">
                <mat-spinner diameter="40"></mat-spinner>
            </div>
        } @else if (!selectedSeason) {
            <!-- Seasons Grid -->
            <div class="seasons-grid">
                @for (
                    season of seasons() | keyvalue: compareSeasons;
                    track $index
                ) {
                    <button
                        class="season-card"
                        (click)="selectSeason(season.key)"
                        [class.season-card--has-episodes]="season.value?.length"
                    >
                        <div class="season-card__number">{{ season.key }}</div>
                        <div class="season-card__label">Season</div>
                        @if (season.value?.length) {
                            <div class="season-card__episodes">
                                {{ season.value.length }}
                                {{
                                    season.value.length === 1
                                        ? 'Episode'
                                        : 'Episodes'
                                }}
                            </div>
                        }
                        <div class="season-card__arrow">
                            <mat-icon>chevron_right</mat-icon>
                        </div>
                    </button>
                }
            </div>
        } @else {
            <!-- Episodes Grid -->
            <div class="episodes-grid">
                @for (episode of seasons()[selectedSeason]; track $index) {
                    @let episodeInfo = getEpisodeInfo(episode);
                    <article
                        class="episode-card"
                        (click)="selectEpisode(episode)"
                    >
                        <div class="episode-card__thumbnail">
                            @if (episodeInfo?.movie_image) {
                                <img
                                    [src]="episodeInfo.movie_image"
                                    (error)="
                                        $event.target.src =
                                            './assets/images/default-episode.png'
                                    "
                                    alt="Episode thumbnail"
                                    loading="lazy"
                                />
                            } @else {
                                <div class="episode-card__placeholder">
                                    <mat-icon>play_circle_outline</mat-icon>
                                </div>
                            }
                            <div class="episode-card__overlay">
                                <div class="episode-card__play">
                                    <mat-icon>play_arrow</mat-icon>
                                </div>
                            </div>
                            <div class="episode-card__number">
                                {{ episode.episode_num }}
                            </div>
                        </div>
                        <div class="episode-card__info">
                            <h4 class="episode-card__title">
                                {{ episode.episode_num }}. {{ episode.title }}
                            </h4>
                            @if (episodeInfo?.plot) {
                                <p class="episode-card__plot">
                                    {{ episodeInfo.plot }}
                                </p>
                            }
                            @if (episodeInfo?.duration) {
                                <span class="episode-card__duration">
                                    {{ episodeInfo.duration }}
                                </span>
                            }
                        </div>
                    </article>
                }
            </div>
        }
    </div>
</section>
