<div class="search-page">
    <div class="header sticky-header">
        <div class="header-top">
            <div class="header-left">
                <h2>{{ 'PORTALS.SIDEBAR.SEARCH' | translate }}</h2>
                
                <div class="type-filters">
                    @for (filter of filterConfig; track filter.key) {
                        <mat-checkbox
                            [ngModel]="filters()[filter.key]"
                            (ngModelChange)="updateFilter(filter.key, $event)"
                        >
                            {{ filter.translationKey | translate }}
                        </mat-checkbox>
                    }
                </div>
            </div>

            <div class="header-right">
                @if (!isGlobalSearch && xtreamStore.searchResults().length > 0) {
                    <div class="results-count">
                        Found {{ xtreamStore.searchResults().length }} results
                    </div>
                }
                @if (isGlobalSearch) {
                    <button mat-icon-button (click)="dialogRef.close()">
                        <mat-icon>close</mat-icon>
                    </button>
                }
            </div>
        </div>

        <div class="search-input-container">
            <app-search-form
                [searchTerm]="searchTerm()"
                (searchTermChange)="updateSearchTerm($event)"
            />
        </div>
    </div>

    <div class="results-container">
        @if (xtreamStore.searchResults().length > 0) { @if (isGlobalSearch) {
        <!-- Global Search Results -->
        <div class="playlist-section">
            <h2 class="section-title">
                Found {{ xtreamStore.searchResults().length }} items across
                {{ (getGroupedResults() | keyvalue).length }} playlists
            </h2>
            @for ( group of getGroupedResults() | keyvalue; track group.key ) {
            <div class="playlist-group">
                <h3 class="playlist-title">
                    <mat-icon>playlist_play</mat-icon>
                    {{ group.key }}
                    <span class="item-count"
                        >({{ $any(group).value.length }} items)</span
                    >
                </h3>
                <div class="results-grid">
                    @for ( item of $any(group).value; track item.id ) {
                    <app-search-result-item
                        [title]="item.title"
                        [description]="item.description"
                        [posterUrl]="item.poster_url"
                        [type]="item.type"
                        [playlistName]="item.playlist_name"
                        [showPlaylistInfo]="isGlobalSearch"
                        (itemClick)="selectItem(item)"
                    />
                    }
                </div>
            </div>
            }
        </div>
        } @else {
        <!-- Playlist-level Search Results -->
        <div class="results-grid">
            @for (item of xtreamStore.searchResults(); track item.id) {
                <app-content-card
                    [posterUrl]="item.poster_url"
                    [title]="item.title"
                    [type]="item.type"
                    [showPlaceholder]="true"
                    (cardClick)="selectItem(item)"
                />
            }
        </div>
        } } @else if (searchTerm() && searchTerm().length >= 3) {
        <div class="no-items">
            <mat-icon>search_off</mat-icon>
            <div class="no-items-content">
                <h3>{{ 'PORTALS.EMPTY_LIST_VIEW.TITLE' | translate }}</h3>
                <p>{{ 'PORTALS.EMPTY_LIST_VIEW.NO_SEARCH_RESULTS' | translate }}</p>
                <p class="search-term-note">No results found for "{{ searchTerm() }}"</p>
            </div>
        </div>
        } @else {
        <div class="no-items initial-state">
            <mat-icon>search</mat-icon>
            <div class="no-items-content">
                <h3>{{ 'PORTALS.SEARCH_VIEW.INITIAL_TITLE' | translate }}</h3>
                <p>{{ 'PORTALS.SEARCH_VIEW.INITIAL_DESCRIPTION' | translate }}</p>
            </div>
        </div>
        }
    </div>
</div>
