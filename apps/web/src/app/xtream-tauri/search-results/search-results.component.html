<app-search-layout
    [searchTerm]="searchTerm()"
    [resultsCount]="xtreamStore.searchResults().length"
    [isLoading]="xtreamStore.isSearching()"
    [showCloseButton]="isGlobalSearch"
    [showResultsCount]="!isGlobalSearch"
    (searchTermChange)="updateSearchTerm($event)"
    (closeClick)="onCloseDialog()"
>
    <!-- Filters -->
    <ng-container filters>
        @for (filter of filterConfig; track filter.key) {
            <mat-checkbox
                [ngModel]="filters()[filter.key]"
                (ngModelChange)="updateFilter(filter.key, $event)"
            >
                {{ filter.translationKey | translate }}
            </mat-checkbox>
        }
    </ng-container>

    <!-- Results -->
    <ng-container results>
        @if (isGlobalSearch) {
            <!-- Global Search Results -->
            <div class="playlist-section">
                <h2 class="section-title">
                    Found {{ xtreamStore.searchResults().length }} items across
                    {{ (getGroupedResults() | keyvalue).length }} playlists
                </h2>
                @for (
                    group of getGroupedResults() | keyvalue;
                    track group.key
                ) {
                    <div class="playlist-group">
                        <h3 class="playlist-title">
                            <mat-icon>playlist_play</mat-icon>
                            {{ group.key }}
                            <span class="item-count"
                                >({{ $any(group).value.length }} items)</span
                            >
                        </h3>
                        <div class="results-grid">
                            @for (item of $any(group).value; track item.id) {
                                <app-search-result-item
                                    [title]="item.title"
                                    [description]="item.description"
                                    [posterUrl]="item.poster_url"
                                    [type]="item.type"
                                    [playlistName]="item.playlist_name"
                                    [showPlaylistInfo]="isGlobalSearch"
                                    (itemClick)="selectItem(item)"
                                />
                            }
                        </div>
                    </div>
                }
            </div>
        } @else {
            <!-- Playlist-level Search Results -->
            <div class="results-grid">
                @for (item of xtreamStore.searchResults(); track item.id) {
                    <app-content-card
                        [posterUrl]="item.poster_url"
                        [title]="item.title"
                        [type]="item.type"
                        [showPlaceholder]="true"
                        (cardClick)="selectItem(item)"
                    />
                }
            </div>
        }
    </ng-container>
</app-search-layout>
